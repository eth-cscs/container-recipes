build qe-71 image:
  extends: .build-image
  variables:
    DOCKERFILE: QuantumESPRESSO/nvhpc-mkl/Dockerfile
    QE_VERSION: 'qe-7.1'
    NAME_TAG: 'qe71'
    DOCKER_BUILD_ARGS: '["CUDA_ARCH=60", "QE_VERSION=$QE_VERSION"]'

build qe-72 image:
  extends: .build-image
  variables:
    DOCKERFILE: QuantumESPRESSO/nvhpc-mkl/Dockerfile
    QE_VERSION: 'qe-7.2'
    NAME_TAG: 'qe72'
    DOCKER_BUILD_ARGS: '["CUDA_ARCH=60", "QE_VERSION=$QE_VERSION"]'

build qe-develop image:
  extends: .build-image
  variables:
    DOCKERFILE: QuantumESPRESSO/nvhpc-mkl/Dockerfile
    QE_VERSION: 'develop'
    NAME_TAG: 'qe-dev'
    DOCKER_BUILD_ARGS: '["CUDA_ARCH=60", "QE_VERSION=$QE_VERSION"]'

test qe71 image hohgant:
  extends: .run-reframe-test
  needs: ["build qe71 image"]
  variables:
    REFRAME_COMMAND: 'reframe -S qe_image="$BASE_IMAGE" -C cscs-reframe-tests/config/cscs.py -c QuantumESPRESSO/rfm_test/qe_check.py --prefix=$SCRATCH --skip-performance-check --report-junit=report.xml -r'
